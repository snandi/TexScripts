\documentclass[11pt]{extarticle} %extarticle for fontsizes other than 10, 11 And 12
%\documentclass[11p]{article}

%%%%%%%%%%%%%%%%%%%%%%%% Packages %%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{amscd}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsxtra}
\usepackage{bbold}
%\usepackage{bigints}
\usepackage{color}
\usepackage{dsfont}
\usepackage{enumerate}
\usepackage[mathscr]{eucal}
%\usepackage{fancyhdr}
\usepackage{float}
%\usepackage{fullpage} %% Dont use this for beamer presentations
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage{latexsym}
\usepackage{listings}
\usepackage{lscape}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage{natbib}
\usepackage{pdfpages}
\usepackage{verbatim}
\usepackage{wrapfig}
\usepackage{xargs}
\DeclareGraphicsExtensions{.pdf,.png,.jpg, .jpeg}

%%%%%%%%%%%%%%%%%%%%%%%% Commands %%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\Sup}{\textsuperscript}
\newcommand{\Exp}{\mathds{E}}
\newcommand{\Prob}{\mathds{P}}
\newcommand{\Z}{\mathds{Z}}
\newcommand{\Ind}{\mathds{1}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\I}{\mathcal{I}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\bes}{\begin{equation*}}
\newcommand{\ees}{\end{equation*}}
\newcommand{\union}{\bigcup}
\newcommand{\intersect}{\bigcap}
\newcommand{\Ybar}{\overline{Y}}
\newcommand{\ybar}{\bar{y}}
\newcommand{\Xbar}{\overline{X}}
\newcommand{\xbar}{\bar{x}}
\newcommand{\betahat}{\hat{\beta}}
\newcommand{\Yhat}{\widehat{Y}}
\newcommand{\yhat}{\hat{y}}
\newcommand{\Xhat}{\widehat{X}}
\newcommand{\xhat}{\hat{x}}
\newcommand{\E}[1]{\operatorname{E}\left[ #1 \right]}
%\newcommand{\Var}[1]{\operatorname{Var}\left( #1 \right)}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}[2]{\operatorname{Cov}\left( #1,#2 \right)}
\newcommand{\N}[2][1=\mu, 2=\sigma^2]{\operatorname{N}\left( #1,#2 \right)}
\newcommand{\bp}[1]{\left( #1 \right)}
\newcommand{\bsb}[1]{\left[ #1 \right]}
\newcommand{\bcb}[1]{\left\{ #1 \right\}}
\newcommand*{\permcomb}[4][0mu]{{{}^{#3}\mkern#1#2_{#4}}}
\newcommand*{\perm}[1][-3mu]{\permcomb[#1]{P}}
\newcommand*{\comb}[1][-1mu]{\permcomb[#1]{C}}

%%%%%%%%%%%%%%%%%%% To change the margins and stuff %%%%%%%%%%%%%%%%%%%
\geometry{left=1in, right=1in, top=0.5in, bottom=0.5in}
%\setlength{\voffset}{0.5in}
%\setlength{\hoffset}{-0.4in}
%\setlength{\textwidth}{7.6in}
%\setlength{\textheight}{10in}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
%\SweaveOpts{concordance=TRUE}
\bibliographystyle{plain}  %Choose a bibliograhpic style

\title{HW 2, Stat 741, Spring 2015}
\author{Subhrangshu Nandi, nandi@stat.wisc.edu}
\date{February 5, 2015}
%\date{}

\maketitle

\subsection*{Problem 1}
\noindent
Data: 3, 4, 5+, 6, 6+, 8+, 11, 14, 15, 16+. \\
\noindent
(a) Kaplan-Meier estimate and its variance of the survival function are:
\[ \hat{F}(t) = \prod_{j: t_j^* \leq t} \left(1 - \frac{d_j}{n_j} \right),\ \ \hat{\Var}(\hat{F(t)})= \{\hat{F}(t)\}^2 \sum_{j: t_j^* \leq t} \frac{d_j}{n_j(n_j - d_j)} \]
% latex table generated in R 2.15.0 by xtable 1.7-4 package
% Wed Feb  4 12:06:05 2015
\begin{table}[H]
\centering
\begin{tabular}{rrr}
  \hline
  Time & $\hat{F}(t)$ & $\hat{\Var}(\hat{F(t)})$ \\ 
  \hline
	3 & 0.90 & 0.0090 \\ 
	4 & 0.80 & 0.0160 \\ 
	6 & 0.69 & 0.0230 \\ 
	11 & 0.51 & 0.0350 \\ 
	14 & 0.34 & 0.0351 \\ 
	15 & 0.17 & 0.0235 \\ 
   \hline
\end{tabular}
\end{table}

\noindent
(b) Nelson-Aalen estimate of the cumulative hazard function and its variance are:
\[ \hat{\Lambda}(t) = \sum_{j: t_j^* \leq t} \hat{\lambda_j} = \sum_{j: t_j^* \leq t} \frac{d_j}{n_j}, \ \ \hat{\Var}(\hat{\Lambda(t)}) = \sum_{j: t_j^* \leq t} \frac{d_j(n_j - d_j)}{n_j^3} \]
Asymptotically, or if there are a lot of events, the variance is often approximated to \\ $\hat{\Var}(\hat{\Lambda(t)}) = \sum_{j: t_j^* \leq t} \frac{d_j}{n_j^2}$, but here since the sample size is small, the previous formula was used, to obtain the variance of the Nelson Aalen estimate of the cumulative hazard function. 
% latex table generated in R 2.15.0 by xtable 1.7-4 package
% Wed Feb  4 16:02:47 2015
\begin{table}[ht]
\centering
\begin{tabular}{rrr}
  \hline
 Time & $\hat{\Lambda}(t)$ & $\hat{\Var}(\hat{\Lambda(t)})$ \\ 
  \hline
	3 & 0.10 & 0.0090 \\ 
	4 & 0.21 & 0.0200 \\ 
	5 & 0.21 & 0.0200 \\ 
	6 & 0.35 & 0.0375 \\ 
	8 & 0.35 & 0.0375 \\ 
	11 & 0.60 & 0.0843 \\ 
	14 & 0.94 & 0.1584 \\ 
	15 & 1.44 & 0.2834 \\ 
	16 & 1.44 & 0.2834 \\ 
   \hline
\end{tabular}
\end{table}


\subsection*{Problem 2: Kalbfleisch \& Prentice \#1.3}
\noindent
The KM estimate of survival probability is
\begin{align*}
\hat{F}(t)\ &{=}\ \prod_{j: t_j^* \leq t} \left(1 - \frac{d_j}{n_j} \right) \\
&{=}\ \left(1 - \frac{d_1}{n_1} \right)\left(1 - \frac{d_2}{n_2} \right)\cdots \left(1 - \frac{d_j}{n_j} \right) \\
&{=}\ \left(\frac{n_1 - d_1}{n_1} \right)\left(\frac{n_2 - d_2}{n_2} \right)\cdots \left(\frac{n_j - d_j}{n_j} \right) \\
&{=}\ \frac{n_2}{n_1} \cdot \frac{n_3}{n_2} \cdots \frac{n_{j+1}}{n_j} \hspace{1in} \text{no censoring} \\
&{=}\ \frac{n_{j+1}}{n_1} \\
&{=}\ \frac{\# \text{ of failures } > t}{n_1}
\end{align*}
Variance of the KM estimate is
\begin{align*}
\hat{\Var}(\hat{F(t)}) \ &{=}\ \{\hat{F}(t)\}^2 \sum_{j: t_j^* \leq t} \frac{d_j}{n_j(n_j - d_j)} \\
&{=}\ \{\hat{F}(t)\}^2\left(\frac{d_1}{n_1 n_2} + \frac{d_2}{n_2 n_3} + \cdots \frac{d_j}{n_j n_{j+1}}\right) \\
&{=}\ \{\hat{F}(t)\}^2\left(-\frac{1}{n_1} + \frac{1}{n_2} -\frac{1}{n_2} + \frac{1}{n_3} + \cdots  -\frac{1}{n_j} + \frac{1}{n_{j+1}}\right) \hspace{0.4in} \left[ \because \frac{d_j}{n_jn_{j+1}} = \frac{n_j - n_{j+1}}{n_jn_{j+1}} = \frac{1}{n_{j+1}} - \frac{1}{n_j} \right] \\
&{=}\ \{\hat{F}(t)\}^2 \left( \frac{1}{n_{j+1}} - \frac{1}{n_1}   \right) \\
&{=}\ \{\hat{F}(t)\}^2 \left( \frac{n_1 - n_{j+1}}{n_1n_{j+1}}   \right) \\
&{=}\ \{\hat{F}(t)\}^2 \left( \frac{n_1 - n_{j+1}}{n_1} \cdot \frac{n_1}{n_{j+1}}   \right)\frac{1}{n_1} \\
&{=}\ \{\hat{F}(t)\}^2 \cdot \frac{(1 - \hat{F}(t))}{\hat{F}(t)\cdot n_1} \\
&{=}\ \frac{1}{n_1}\cdot \hat{F}(t) (1 - \hat{F}(t))
\end{align*}
\subsection*{Problem 3}
\noindent
Justification of the "Redistribution-to-the-right" algorithm for the KM estimator:\\
Let $t_j^*$ and $t_{j+1}^*$ be two consecutive failure time points. Then, from the KM formula, we must have $\hat{F}(t^*_{j+1}+) = \hat{F}(t^*_{j}+)\left(1 - \frac{d_{j+1}}{n_{j+1}}\right)$. \\
Now, let there be $m_j$ censoring between $t^*_j$ and $t^*_{j+1}$. For each censoring time point, starting from $t_{j,1},\ t_{j,2},\ \dots, t_{j,m_j}$, the weights are redistributed equally to all points to their right. The contribution from the censoring time point $t_{j,1}$ will be $\frac{1}{n_{j+1} + m_j - 1}$, to each point to its right. Hence, after each redistribution, the mass of all the time points to the right of that point, contributing to the survival function, is the same. Hence, the mass that is redistributed between $t^*_j$ and $t^*_{j+1}$ is the only difference between $F(t^*_j +)$ and $F(t^*_{j+1} +)$. The redistributed mass is $\frac{F(t^*_{j} +)}{n_{j+1}}\cdot\frac{d_{j+1}}{n_1}$

\subsection*{Problem 4}
\noindent
(a) The KM and NA estimators of survival time for dataset I are:

% latex table generated in R 2.15.0 by xtable 1.7-4 package
% Wed Feb  4 18:58:26 2015
\begin{table}[H]
\centering
\begin{tabular}{rrrr||rrr}
  \hline
 & time & $\hat{F}(t)_{KM}$ & $\hat{F}(t)_{NA}$ & time & $\hat{F}(t)_{KM}$ & $\hat{F}(t)_{NA}$ \\ 
  \hline
1 & 1 & 0.9854 & 0.9855 & 99 & 0.4257 & 0.4295 \\ 
  2 & 2 & 0.9781 & 0.9782 & 100 & 0.4180 & 0.4218 \\ 
  3 & 3 & 0.9708 & 0.9710 & 103 & 0.4101 & 0.4139 \\ 
  4 & 4 & 0.9635 & 0.9637 & 105 & 0.4021 & 0.4058 \\ 
  5 & 7 & 0.9416 & 0.9420 & 110 & 0.3940 & 0.3978 \\ 
  6 & 8 & 0.9124 & 0.9133 & 111 & 0.3779 & 0.3819 \\ 
  7 & 10 & 0.8978 & 0.8988 & 112 & 0.3699 & 0.3739 \\ 
  8 & 11 & 0.8905 & 0.8915 & 117 & 0.3538 & 0.3579 \\ 
  9 & 12 & 0.8759 & 0.8770 & 118 & 0.3458 & 0.3499 \\ 
  10 & 13 & 0.8613 & 0.8625 & 122 & 0.3377 & 0.3419 \\ 
  11 & 15 & 0.8467 & 0.8480 & 123 & 0.3377 & 0.3419 \\ 
  12 & 16 & 0.8394 & 0.8407 & 126 & 0.3295 & 0.3336 \\ 
  13 & 18 & 0.8175 & 0.8191 & 132 & 0.3213 & 0.3254 \\ 
  14 & 19 & 0.8029 & 0.8046 & 133 & 0.3130 & 0.3172 \\ 
  15 & 20 & 0.7883 & 0.7901 & 139 & 0.3048 & 0.3089 \\ 
  16 & 21 & 0.7737 & 0.7756 & 140 & 0.2965 & 0.3007 \\ 
  17 & 22 & 0.7664 & 0.7683 & 143 & 0.2883 & 0.2924 \\ 
  18 & 24 & 0.7518 & 0.7538 & 144 & 0.2801 & 0.2842 \\ 
  19 & 25 & 0.7299 & 0.7322 & 151 & 0.2718 & 0.2760 \\ 
  20 & 27 & 0.7226 & 0.7248 & 153 & 0.2636 & 0.2677 \\ 
  21 & 29 & 0.7152 & 0.7175 & 156 & 0.2554 & 0.2595 \\ 
  22 & 30 & 0.7004 & 0.7028 & 162 & 0.2389 & 0.2433 \\ 
  23 & 31 & 0.6857 & 0.6882 & 164 & 0.2306 & 0.2350 \\ 
  24 & 33 & 0.6783 & 0.6808 & 177 & 0.2224 & 0.2268 \\ 
  25 & 35 & 0.6709 & 0.6735 & 182 & 0.2224 & 0.2268 \\ 
  26 & 36 & 0.6636 & 0.6661 & 186 & 0.2139 & 0.2182 \\ 
  27 & 42 & 0.6562 & 0.6587 & 200 & 0.2053 & 0.2097 \\ 
  28 & 43 & 0.6488 & 0.6514 & 201 & 0.1967 & 0.2011 \\ 
  29 & 44 & 0.6415 & 0.6440 & 216 & 0.1882 & 0.1926 \\ 
  30 & 45 & 0.6341 & 0.6367 & 228 & 0.1796 & 0.1840 \\ 
  31 & 48 & 0.6267 & 0.6293 & 231 & 0.1711 & 0.1754 \\ 
  32 & 49 & 0.6193 & 0.6219 & 242 & 0.1621 & 0.1665 \\ 
  33 & 51 & 0.5972 & 0.6001 & 250 & 0.1531 & 0.1575 \\ 
  34 & 52 & 0.5751 & 0.5783 & 260 & 0.1441 & 0.1485 \\ 
  35 & 53 & 0.5677 & 0.5709 & 278 & 0.1351 & 0.1395 \\ 
  36 & 54 & 0.5530 & 0.5563 & 283 & 0.1261 & 0.1305 \\ 
  37 & 56 & 0.5456 & 0.5489 & 287 & 0.1171 & 0.1215 \\ 
  38 & 59 & 0.5382 & 0.5416 & 314 & 0.1081 & 0.1125 \\ 
  39 & 61 & 0.5309 & 0.5342 & 340 & 0.0990 & 0.1035 \\ 
  40 & 63 & 0.5235 & 0.5268 & 357 & 0.0900 & 0.0945 \\ 
  41 & 72 & 0.5161 & 0.5195 & 378 & 0.0810 & 0.0855 \\ 
  42 & 73 & 0.5087 & 0.5121 & 384 & 0.0720 & 0.0765 \\ 
  43 & 80 & 0.4940 & 0.4975 & 389 & 0.0630 & 0.0675 \\ 
  44 & 82 & 0.4866 & 0.4901 & 392 & 0.0540 & 0.0585 \\ 
  45 & 83 & 0.4866 & 0.4901 & 411 & 0.0450 & 0.0495 \\ 
  46 & 84 & 0.4791 & 0.4826 & 467 & 0.0360 & 0.0406 \\ 
  47 & 87 & 0.4716 & 0.4751 & 553 & 0.0270 & 0.0316 \\ 
  48 & 90 & 0.4640 & 0.4675 & 587 & 0.0180 & 0.0226 \\ 
  49 & 92 & 0.4564 & 0.4599 & 991 & 0.0090 & 0.0137 \\ 
  50 & 95 & 0.4412 & 0.4448 & 999 & 0.0000 & 0.0051 \\ 
  51 & 97 & 0.4412 & 0.4448 &  &  &  \\ 
   \hline
\end{tabular}
\end{table}
\noindent
(b) The estimated survival probabilities at day 30 are $0.6341$ (KM) and $0.6367$ (NA). The estimated survival probabilities at day 60 are $0.5382$ (KM) and $0.5416$ (NA).\\
\noindent
(c) The estimated hazard at day 30 is $0.0206$. The estimated hazard at day 60 is $0$. \\
\noindent
(d) The cumulative hazard at day 30 is $0.3527$. The estimated hazard at day 60 is $0.6133$.
\noindent
(e) The estimated median time is $80$ days

Now, using the two treatment groups, the same questions above can be answered as follows:
\begin{center}
\begin{figure}[H]
\includegraphics[scale=0.48]{Plot_4a.pdf}
\end{figure}
\end{center}

\begin{itemize}
\item 
The estimated survival probabilities at day 30 for treatment 1 is $0.7241$ (KM) and for treatment 2 is $0.6765$ (KM). The estimated survival probabilities at day 60 for treatment 1 is $0.5911$ (KM) and for treatment 2 is $0.4853$ (KM).
\item
The estimated hazard at day 30 for treatment 1 is $0.02$ and treatment 2 is $0.0213$. The estimated hazard at day 60 is $0$, for both treatments.
\item
The cumulative hazard at day 30 for treatment 1 is $0.299$ and treatment 2 is $0.3845$. The cumulative hazard at day 60 for treatment 1 is $0.4948$ and treatment 2 is $0.7109$
\item
The estimated median time is $103$ days for treatment 1 and $52.5$ days for treatment 2.
\end{itemize}


%\subsection*{Problem 5: Kalbfleisch \& Prentice \#1.8}
%\noindent
%$t_1 < t_2 < \cdots < t_k$ are observed failure times in a sample of size $n_0$

\end{document}
